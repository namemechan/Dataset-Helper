# Dataset Helper

**데이터셋의 파일명, 태깅, 단일파일 정리 및 용량절약을위한 webp변환 지원**

## ✨ 주요 기능

### 0. 기본 사용법
데이터셋이 있는 폴더를 선택하고 병렬처리에 사용할 코어수를 설정합니다.

### 1. 이름 변경
데이터셋 파일들의 이름을 규칙적으로 정리합니다.
- **이미지-텍스트 쌍(Pair) 유지:** 이미지 파일 이름을 변경할 때, 짝이 되는 캡션(.txt) 파일도 자동으로 함께 변경되어 데이터셋의 연결이 끊어지지 않도록 보장합니다.
- **안전한 실행 취소 (Undo):** 실수로 이름을 잘못 변경했더라도, 작업 이력을 통해 즉시 이전 상태로 완벽하게 복구할 수 있습니다.
- **실시간 미리보기:** 변경될 파일명을 미리 리스트로 확인하여 의도한 대로 변경되는지 검증할 수 있습니다.

### 2. 단일 파일 찾기
학습에 불필요하거나 오류를 유발할 수 있는 데이터를 정리합니다.
- **짝 없는 파일(Orphan Files) 감지:** 캡션 텍스트가 없는 이미지나, 이미지가 없는 텍스트 파일을 자동으로 찾아냅니다.
- **격리 및 삭제:** 발견된 파일들을 일괄 삭제하거나, 검토를 위해 별도의 폴더로 이동시킬 수 있습니다.
- **하위 폴더 포함 검색:** 옵션을 통해 하위 폴더 깊숙이 숨어있는 파일들까지 모두 스캔합니다.

### 3. 태그 처리
Danbooru 스타일 태그 및 자연어 캡션을 효율적으로 편집합니다.
- **태그 정렬 및 표준화:** `1girl`, `solo`와 같은 핵심 태그를 캡션의 맨 앞으로 이동시킵니다.
- **자동 태그 주입:** 캡션에 인원수 정보가 누락된 경우, 설정된 값(성별, 인원수)을 기반으로 태그를 자동 생성하여 추가합니다.
- **[New] 인접 태그 수정:** 특정 태그를 기준으로 앞이나 뒤에 있는 태그의 접두사/접미사를 수정합니다. (예: `b` 뒤의 `c` 앞에 `@` 붙이기 -> `b, @c`)
- **[New] CSV 기반 특수 처리:** 사용자가 제공한 CSV 파일을 기반으로 특정 카테고리의 태그들을 일괄 추가, 치환, 삭제합니다. (언더바/공백 및 대소문자 무관 정밀 매칭 지원)
- **안전한 실행 취소 (Undo):** 태그 처리 작업 후에도 [실행 취소] 버튼을 통해 이전 상태로 복구할 수 있습니다.
- **하위 폴더 포함 검색:** 옵션을 통해 하위 폴더에 있는 텍스트 파일까지 한 번에 처리합니다.
- **일괄 편집 기능 (조건부 실행 지원):**
  - **치환:** 특정 태그를 찾아 오타를 수정하거나 다른 태그로 일괄 변경합니다.
  - **삭제:** 학습에 방해되는 불필요한 태그들을 제거합니다. (특정 태그가 있을 때만 삭제하는 **조건부 삭제** 지원)
  - **추가:** 필요한 트리거 워드나 속성 태그를 삽입합니다. (특정 태그가 있을 때만 추가하는 **조건부 추가** 지원)

### 4. 이미지 변환
다양한 소스의 이미지를 학습에 최적화된 포맷으로 표준화합니다.
- **입력/출력 폴더 설정:** 화면상단에 설정되어있는 작업 폴더 사용하지않습니다. 데이터셋(이미지)이 있는 폴더를 입력 폴더로 설정하고 출력 폴더를 설정합니다.
- **파일명 접미사 추가:** 변환된 이미지의 접미사를 추가합니다.
- **포맷 변환 및 리사이징:** JPG, PNG, WEBP 등 다양한 포맷으로의 일괄 변환과 해상도 조절을 지원합니다.
- **메타데이터 보존:** 변환 과정에서 손실되기 쉬운 **EXIF** 정보는 물론, **PNG Info (AI 생성 파라미터)**, **Stealth PNG Info**까지 감지하여 대상 파일에 최대한 보존합니다.

### 5. 중복 및 유사 이미지 제거 (Duplicate Finder)
데이터셋의 품질을 저하시키는 중복 데이터를 정밀하게 걸러냅니다.
- **[New] 독립 경로 사용:** 상단의 공통 작업 폴더 대신, 중복 찾기 탭에서 직접 선택한 별도의 폴더를 독립적으로 검색할 수 있습니다.
- **다중 검색 알고리즘:**
  - **완전 중복 (MD5):** MD5해시가 동일한 파일을 찾아냅니다.
  - **유사 이미지 (dHash):** 해상도가 다르거나 약간의 변형이 있어도 시각적으로 유사한 이미지를 검출합니다.
  - **태그 내용 기반 검색:** 이미지뿐만 아니라 짝이 되는 **캡션(.txt) 파일의 내용**을 분석하여, 태그 구성이 유사한 이미지들을 찾아냅니다. (Jaccard 유사도 활용)
- **유사도 그룹 검색 (Range Search):** 지정된 범위(예: 0~3) 내의 모든 유사도 그룹을 한 번에 검색하여 계층적으로 표시합니다.
- **최적화된 성능:** Union-Find 알고리즘을 도입하여 범위 검색 시에도 단일 검색과 대등한 빠른 속도를 제공하며, 메인 설정의 '사용 코어' 수를 반영합니다.
- **직관적인 비교 UI:** 검출된 중복 그룹/쌍을 직접 비교하며 유지할 파일을 선택하고, 나머지는 삭제하거나 이동할 수 있습니다. (2개 아이템은 '쌍', 3개 이상은 '그룹'으로 표시)
- **이미지 비율 비교:** 이미지 비율(Aspect Ratio)이 같은 파일끼리만 비교하도록 설정하여 불필요한 비교를 줄여 검색 속도와 정확도를 높일 수 있습니다.
- **텍스트 파일 동반 처리:** 이미지를 삭제하거나 이동할 때, 짝이 되는 캡션 파일(.txt)도 함께 처리하는 옵션을 제공합니다.

## 🛠 설치 및 실행 방법

### 요구 사항
- Python 3.8 이상
- Windows 운영체제

### 설치 및 실행
- 직접 실행 : Dataset-Helper-(버전).exe를 실행합니다
- 클론 실행 : 
1. 이 저장소를 다운로드하거나 클론합니다.
2. 필요한 패키지를 설치합니다. (requirements.txt 참고)
3. 프로그램을 실행합니다 (main.py)

### 💡 사용 팁 (Tips)
- **중복 찾기 범위 검색:** '유사도 그룹 검색'을 사용하면 여러 단계의 유사도를 한 번에 확인할 수 있어 데이터셋에 최적인 필터링 값을 찾기 매우 용이합니다. 시작값이 종료값보다 크더라도 프로그램이 자동으로 순서를 교정하여 검색합니다.
- **멀티코어 설정:** '이미지 변환'이나 '태그 처리' 시 코어 수를 높이면 속도가 빨라지지만 다른 작업(웹 서핑 등)이 느려질 수 있습니다. 원활한 멀티태스킹을 원하시면 전체 코어 수보다 2~4개 적게 설정하는 것을 권장합니다.